<div class="row">
  <div class="col-12">
    <span class="d-inline-block"><h5><b>Name: </b> <%= @resource.name %></h5></span>
  </div>
</div>
<div class="row">
  <div class="col-8">
    <div class="row mt-2">
      <div class="col-6">
       <span class="d-inline-block"><b>From-To: </b><%= from_to_date(@resource) %></span>
     </div>
  </div>
  </div>
</div>
<div class="row">
  <div class="col-8">
    <div class="row mt-2">
      <div class="col-6">
        <span class="d-inline-block"><b>Status: </b><%= @resource.status %></span>
      </div>
  </div>
  </div>
</div>
<div class="row">
  <div class="col-8">
    <div class="row mt-2">
      <div class="col-6">
      <% if @resource.min_members.present? && @resource.max_members.present? %>
        <span class="d-inline-block"><b>Members: </b><%= @resource.min_members %></span>-
        <span class="d-inline-block"><b></b><%= @resource.max_members %></span>
      <% else %>
        <span class="d-inline-block"><b>Members: </b>Not fixed</span>
      <% end %>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-8">
    <div class="row">
      <div class="col-6">
       <!-- <span class="d-inline-block"><b>Transport Type: </b><%#= @resource&.transport_type&.name %></span> -->
     </div>
    <div class="col-6">
      <!-- <span class="d-inline-block"><b>Price: </b><%#= @resource.price %></span> -->
    </div>
  </div>
  </div>
</div>
<div class="row">
  <div class="col-8">
    <div class="row mt-2">
      <div class="col-6">
       <span class="d-inline-block"><b>Duration: </b><%= @resource.duration+' '+@resource.duration_type %></span>
     </div>
    <div class="col-6">
       <!-- <span class="d-inline-block"><b>Expenses: </b><%#= @resource.expenses %></span> -->
    </div>
  </div>
  </div>
</div>
<br>
<% @duration_count =  @resource.duration_type == "Hours" ? 1 : @resource.duration.to_i  %>
<%= form_tag({controller: :itineraries, action: :create_itinerary_schedules}, {method: :post})  do |f| %>
  <% for i in 1..@duration_count %>
    <div class="row">
      <div class="col-8">
        <div class="card">
          <div class="card-header">
          Day <%= i %> - <b><%= @resource.start_date ? (@resource.start_date.to_date+i-1).strftime("%d %B %Y") : 'Not Fixed' %></b>
          </div>
          <div class="card-body">

            <div class="row pickup_attributes">
              <div class="col-5">
                <div class="row">
                  <div class="col-6 mt-2">
                    <label>Pickup Time:</label>
                  </div>
                  <div class="col-6">
                    <%= time_field_tag "itinerary_schedules[#{i}][pickup_time]", @resource&.itinerary_schedules[i-1]&.pickup_time&.strftime("%H:%M"), class: "form-control pickup" %>
                  </div>
                </div>
              </div>
              <div class="col-5"> 
                <%= text_field_tag "itinerary_schedules[#{i}][pickup_location]" ,@resource&.itinerary_schedules[i-1]&.pickup_location, class: 'form-control pickup ', placeholder: 'Pickup location' %>
              </div>
              <% if i > 1 %>
                <div class="col-2">
                  <label>Not fixed</label>
                  <%= check_box("itinerary_schedules[#{i}]", "  no_pickup", { class: 'pickup_not_fixed' }, "true", "false") %>
                </div>
              <% end %>
            </div>
            <br>
            <% if @resource.itinerary_schedules.present? %>
              <div class="row">
                <div class="col-3 mr-3 mt-1">
                 Add products:
                </div>
                <% if @resource.itinerary_schedules[i-1].itinerary_products.present? %>
                  <div class="col-8">
                    <% @resource.itinerary_schedules[i-1].itinerary_products.each do |itinerary_product| %>
                      <div class="row mb-2">
                        <div class="col-5">
                          <%= time_field_tag :timing, itinerary_product.timing&.strftime("%H:%M"), class: "form-control product_timings" %>
                          <%= hidden_field_tag "product_itinerary_id", itinerary_product.id, class: "product_itinerary_id" %>
                        </div>
                        <div class="col-5">
                          <span class="mr-2"><%= link_to itinerary_product.product&.name, product_path(itinerary_product.product), target: "_blank" %></span>
                          <%= link_to(image_tag('remove.png'), delete_itinerary_products_itinerary_path(itinerary_product_id: itinerary_product.id),method: :delete, data: {confirm: "Are you sure?"}) %>
                        </div>
                      </div>
                    <% end %>
                  </div>
                <% else %>
                  <div class="col-4"> 
                    <%= link_to(image_tag('add.png'), show_nearby_products_products_path(itinerary_schedule_id: @resource.itinerary_schedules[i-1].id),:"data-turbolinks" => false) %>
                  </div>
                <% end %>
              </div>
              <br>
            <% end %>
            <div class="row drop_attributes">
              <div class="col-5">
                <div class="row">
                  <div class="col-6 mt-2">
                    <label>Drop Time:</label>
                  </div>
                  <div class="col-6">
                    <%= time_field_tag "itinerary_schedules[#{i}][drop_time]", @resource&.itinerary_schedules[i-1]&.drop_time&.strftime("%H:%M"), class: "form-control drop" %>
                  </div>
                </div>
              </div>
              <div class="col-5"> 
                <%= text_field_tag "itinerary_schedules[#{i}][drop_location]",@resource&.itinerary_schedules[i-1]&.drop_location, class: 'form-control drop', placeholder: 'Drop location' %>
              </div>
              <% if i < @duration_count %>
                <div class="col-2">
                  <label>Not fixed</label>
                  <%= check_box("itinerary_schedules[#{i}]", "no_drop", { class: 'drop_not_fixed' }, "true", "false") %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div><br>
  <% end %>
  <%= submit_tag 'Submit', class: 'btn btn-primary' %>
<% end %>
<script>
  $('.product_timings').on('blur',function(){
    var timing = $(this).val();
    var itinerary_product_id = $(this).siblings('.product_itinerary_id').val();
    if (timing != ""){
      $.ajax({
        url: '<%= update_intinerary_products_itinerary_path %>',
        type: 'Patch',
        data: {timing: timing,itinerary_product_id: itinerary_product_id },
        dataType: 'script'
      })
    }
  })

</script>



